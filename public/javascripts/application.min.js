$(document).ready(function(){$save=1;$(":input","form.quote_form").bind("change",function(){setConfirmUnload(true)});$(".recover_results").slideUp();$("#down").click(function(){$(".recover_results").slideToggle()});$("div.subtotal.factura").css("visible","none");$("#options_current_store").change(function(){$(this).parents("form").submit()});$(".print").click(function(){window.print();return false});$first=null;$.fn.clearForm=function(){return this.each(function(){var j=this.type,i=this.tagName.toLowerCase();if(i=="form"){return $(":input",this).clearForm()}if(i=="fieldset"){return $(":input",this).clearForm()}if(j=="text"||j=="password"||i=="textarea"){if($first==null){$first=this;this.focus()}this.value=""}else{if(j=="checkbox"||j=="radio"){this.checked=false}}if(i=="select"){this.options.length=0}})};function g(i){return"<strong>"+i[1]+"</strong> - <strong class='em_code'>"+i[4]+"</strong> - <em class='em_code'>"+i[3]+"</em> - <em class='em_code'>"+i[2]+"</em> - Stock: "+i[5]}function c(i){d}function f(i){$.getJSON("/sales/product_prices",{product_id:i},function(l){var j="";for(var k=0;k<l.length;k++){j+='<option value="'+l[k].price.amount+'">S/.'+l[k].price.amount+"</option>"}$("#exit_order_detail_price").html(j)})}function e(i){$("#quote_contact_name").val("");$("#quote_sending_details").val("");$.getJSON("/clientes/"+i,{id:i},function(j){$("#quote_contact_name").val(j.client.contact_person);$("#quote_sending_details").val(j.client.contact_email)})}function b(i){$("input#input_order_detail_additional_code").val("");$("#buying_price").val(0);$("#base_price").val(0);$(".input_order_boxed_price").val(0);$(".input_order_wholesale_price").val(0);$(".input_order_final_price").val(0);$(".input_order_final_price_polo").val(0);$.getJSON("/productos/"+i,{id:i},function(j){$("input#input_order_detail_additional_code").val(j.additional_code)});$.getJSON("/productos/"+i+"/precios/",{product_id:i},function(j){$("#buying_price").val(j[0]);$("#base_price").val(j[1][0].price.amount);$(".input_order_boxed_price").val(j[1][1].price.amount);$(".input_order_wholesale_price").val(j[1][2].price.amount);$(".input_order_final_price").val(j[1][3].price.amount);$(".input_order_final_price_polo").val(j[1][4].price.amount)});$("input#input_order_detail_quantity").focus()}$("#input_order_detail_product_id").focus(function(){documento=$("#input_order_document").attr("value");provider=$("#input_order_provider_id").attr("value");year=$("#input_order_order_date_1i").attr("value");month=$("#input_order_order_date_2i").attr("value");day=$("#input_order_order_date_3i").attr("value");store=$("#input_order_store_id").attr("value");owner=$("#input_order_owner_id").attr("value");$.ajax({data:"order[document]="+documento+"&order[provider]="+provider+"&order[order_date][year]="+year+"&order[order_date][month]="+month+"&order[order_date][day]="+day+"&order[store_id]="+store+"&order[owner_id]="+owner+"&",url:"/buying_orders/update_order"})});$("#exit_order_detail_product_id").focus(function(){documento=$("#exit_order_document").attr("value");year=$("#exit_order_sending_date_1i").attr("value");month=$("#exit_order_sending_date_2i").attr("value");day=$("#exit_order_sending_date_3i").attr("value");client_id=$(".exit_order_hidden_client_id").attr("value");driver_name=$("#exit_order_driver_name").attr("value");driver_dni=$("#exit_order_driver_dni").attr("value");extra_data=$("#exit_order_extra_data").attr("value");$.ajax({data:"exit_order[document]="+documento+"&exit_order[sending_date][year]="+year+"&exit_order[sending_date][month]="+month+"&exit_order[sending_date][day]="+day+"&exit_order[client_id]="+client_id+"&exit_order[driver_name]="+driver_name+"&exit_order[driver_dni]="+driver_dni+"&exit_order[extra_data]="+extra_data,url:"/exit_orders/update_exit_order"})});$("a.sublink").click(function(){documento=$("#input_order_document").attr("value");provider=$("#input_order_provider_id").attr("value");year=$("#input_order_order_date_1i").attr("value");month=$("#input_order_order_date_2i").attr("value");day=$("#input_order_order_date_3i").attr("value");store=$("#input_order_store_id").attr("value");owner=$("#input_order_owner_id").attr("value");$.ajax({data:"order[document]="+documento+"&order[provider]="+provider+"&order[order_date][year]="+year+"&order[order_date][month]="+month+"&order[order_date][day]="+day+"&order[store_id]="+store+"&order[owner_id]="+owner+"&",url:"/buying_orders/update_order",success:function(i){window.location="/inventory";return false}});return false});$("#quote_detail_product_id").focus(function(){documento=$("#quote_document").attr("value");client=$(".quote_hidden_client_id").attr("value");year=$("#quote_quote_date_1i").attr("value");month=$("#quote_quote_date_2i").attr("value");day=$("#quote_quote_date_3i").attr("value");price_type=$("#quote_price_type").attr("value");store=$("#quote_store_id").attr("value");duration=$("#quote_duration").attr("value");sending_details=$("#quote_sending_details").attr("value");contact_name=$("#quote_contact_name").attr("value");quote_comments=$("#quote_quote_comments").attr("value");$.ajax({data:"quote[document]="+documento+"&quote[client_id]="+client+"&quote[quote_date][year]="+year+"&quote[quote_date][month]="+month+"&quote[quote_date][day]="+day+"&quote[store_id]="+store+"&quote[duration]="+duration+"&quote[contact_name]="+contact_name+"&quote[sending_details]="+sending_details+"&quote[quote_comments]="+quote_comments+"&quote[price_type]="+price_type,url:"/quotes/update_quote"})});$("#send_order_detail_product_id").focus(function(){documento=$("#send_order_document").attr("value");year=$("#send_order_send_date_1i").attr("value");month=$("#send_order_send_date_2i").attr("value");day=$("#send_order_send_date_3i").attr("value");store=$("#send_order_store_id").attr("value");owner=$("#send_order_owner_id").attr("value");$.ajax({data:"send_order[document]="+documento+"&send_order[send_date][year]="+year+"&send_order[send_date][month]="+month+"&send_order[send_date][day]="+day+"&send_order[store_id]="+store+"&send_order[owner_id]="+owner+"&",url:"/sending/update_send_order"})});function a(){$.ajax({data:"order_detail[product_id]="+v,success:function(i){$("#prices_list").html(i)},url:"/sales/product_price"})}function h(i){$.getJSON("/productos/"+i+"/precios/",{product_id:i},function(j){$("#base_price").html(j[1][0].price.amount);$("#boxed_price").html(j[1][1].price.amount);$("#wholesale_price").html(j[1][2].price.amount);$("#final_price").html(j[1][3].price.amount);$("#final_price_polo").html(j[1][4].price.amount)});$("input#quote_detail_quantity").focus()}$("input#input_order_detail_product_id").autocomplete("buying_orders/auto_complete_for_input_order",{formatItem:g,callbackFunction:b,hidden_input:".input_order_detail_hidden_product_id"});$("input#send_order_detail_product_id").autocomplete("buying_orders/auto_complete_for_input_order",{formatItem:g,hidden_input:".send_order_detail_hidden_product_id"});$("input#sending_guide_detail_product_id").autocomplete("buying_orders/auto_complete_for_input_order",{formatItem:g,hidden_input:".sending_guide_detail_hidden_product_id"});$("input#exit_order_detail_product_id").autocomplete("/buying_orders/auto_complete_for_input_order",{formatItem:g,callbackFunction:f,hidden_input:".exit_order_detail_hidden_product_id"});$("input#order_detail_product_id").keypress(function(i){$save=0;if(i.which==13){$(".product_name").html("Buscando...");$(".product_stock").html("Buscando...");$.ajax({data:"order_detail[product_code]="+this.value,success:function(j){result=j.split(",");f(result[0]);$(".order_detail_hidden_product_id").val(result[0]);$(".product_name").html(result[1]);$(".product_stock").html(result[2]);$save=1},error:function(j){$(".product_name").html("No se halló ningún producto");$(".product_stock").html("--")},url:"/sales/auto_complete_for_input_order"})}});$("input#order_detail_product_id").focus(function(){$save=0});$("input#order_detail_product_id").blur(function(){$save=1});$("#order_submit.form_button ").click(function(){if($save==1){return confirm("¿Finalizar venta?")}else{return false}});$("input#order_client_id").autocomplete("sales/auto_complete_for_order",{formatItem:g,hidden_input:".order_hidden_client_id"});$("input#sending_guide_client_id").autocomplete("sales/auto_complete_for_order",{formatItem:g,hidden_input:".sending_guide_hidden_client_id"});$("input#quote_client_id").autocomplete("sales/auto_complete_for_order",{formatItem:g,hidden_input:".quote_hidden_client_id",callbackFunction:e});$("input#exit_order_client_id").autocomplete("/sales/auto_complete_for_order",{formatItem:g,hidden_input:".exit_order_hidden_client_id",callbackFunction:e});$("a#boleta").click(function(){setup_boleta();getLastOrderByType("boleta")});$("a#factura").click(function(){setup_factura();getLastOrderByType("factura")});$("a#nota_de_credito").click(function(){setup_nota_de_credito();getLastOrderByType("nota_de_credito")});$("input#buying_price").keyup(function(i){base=1.1;boxed=1.3;wholesale=1.4;trigal=1.5;polo=1.6;category=$("#product_category_id").val();if(category!=""){if(category=="11"){base=1.03;boxed=1.08;wholesale=1.08;trigal=1.25;polo=0}}subcategory=$("#product_subcategory_id").val();if(subcategory!=""){if(subcategory=="10"){base=1.03;boxed=1.08;wholesale=1.25;trigal=1.5;polo=1.5}}price_value=this.value/1.19;$("input#base_price").attr("value",roundNumber(price_value*base*1.19,2));$("input.input_order_boxed_price").attr("value",roundNumber(price_value*boxed*1.19,2));$("input.input_order_wholesale_price").attr("value",roundNumber(price_value*wholesale*1.19,2));$("input.input_order_final_price").attr("value",roundNumber(price_value*trigal*1.19,2));$("input.input_order_final_price_polo").attr("value",roundNumber(price_value*polo*1.19,2))});$("#content").listen("focus","input, textarea, select",function(){$(this).addClass("active")});$("#content").listen("blur","input, textarea, select",function(){$(this).removeClass("active")});$("#content table tbody tr").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})});$("img.product_image").hover(function(){$(this).parent("div").addClass("hover")},function(){$(this).parent("div").removeClass("hover")});function clean_forms(){$("#fieldset_buying_orders").clearForm();$("#fieldset_sales").clearForm();$("#fieldset_sending").clearForm()}function setup_boleta(){$("#order_type").attr("value","boleta");$("a#boleta").parents("ul").find("a").each(function(){$(this).removeClass("active")});$("div#content h2").attr("innerHTML","Boleta de Venta");$("a#boleta").addClass("active");$("div.subtotal.factura").css("display","none")}function setup_factura(){$("a#factura").parents("ul").find("a").each(function(){$(this).removeClass("active")});$("#order_type").attr("value","factura");$("div#content h2").attr("innerHTML","Factura");$("a#factura").addClass("active");$("div.subtotal.factura").css("display","block")}function setup_nota_de_credito(){$("a#nota_de_credito").parents("ul").find("a").each(function(){$(this).removeClass("active")});$("#order_type").attr("value","nota_de_credito");$("div#content h2").attr("innerHTML","Nota de cr&eacute;dito");$("a#nota_de_credito").addClass("active");$("div.subtotal.factura").css("display","block")}function getLastOrderByType(a){$.ajax({data:"order[type]="+a,success:function(b){$("#order_number").attr("value",b)},url:"/sales/last_order_number"})}function roundNumber(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)}function setConfirmUnload(a){window.onbeforeunload=(a)?unloadMessage:null}function unloadMessage(){return"Aún no ha finalizado la cotización. Si cambia de pantalla podrá recuperarla luego en la zona superior."};